---
title: 'GitHub Pages の独自ドメイン設定手順についての深掘り'
date: '2025-05-02'
lastmod: '2025-05-02'
tags: ['ブログ開発', 'ドメイン', 'GitHub']
draft: false
summary: '前回までの記事でドメインを取得してGitHub Pagesに独自ドメインを設定しました。この記事では主に設定内容について疑問に感じた部分を深掘りして理解していきたいと思います。'
---

はじめに
---

前回までの記事でドメインを取得してGitHub Pagesに独自ドメインを設定しました。この記事では主に設定内容について疑問に感じた部分を深掘りして理解していきたいと思います。前回までの記事の内容に関する学習記録になりますので、設定手順は以下をご参照ください。

「[ブログ用に Cloudflare Registrar で .dev ドメインを取得した](https://s1m4ne.dev/blog/2025-05-01-get-dev-domain)」

「[Cloudflare Registrar で GitHub Pages に独自ドメインを設定する](https://s1m4ne.dev/blog/2025-05-01-set-custom-domain)」

体系的に学習したわけではないので全体構成が不自然になっているかもしれません。X（旧Twitter）上で度々見かける「[DNSがよくわかる教科書](https://www.amazon.co.jp/DNS%E3%81%8C%E3%82%88%E3%81%8F%E3%82%8F%E3%81%8B%E3%82%8B%E6%95%99%E7%A7%91%E6%9B%B8-%E6%A0%AA%E5%BC%8F%E4%BC%9A%E7%A4%BE%E6%97%A5%E6%9C%AC%E3%83%AC%E3%82%B8%E3%82%B9%E3%83%88%E3%83%AA%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9-JPRS-%E6%B8%A1%E9%82%89%E7%B5%90%E8%A1%A3%E3%80%81%E4%BD%90%E8%97%A4%E6%96%B0%E5%A4%AA%E3%80%81%E8%97%A4%E5%8E%9F%E5%92%8C%E5%85%B8/dp/479739448X)」という書籍を今度読もうと思っているので、深掘りしすぎないようにしたいと思います。

DNS レコードとは
---

DNSレコードとは、ドメイン名に関連付けられた IP アドレスや、ドメインへのリクエストをどのように処理するかなどの情報を定義したものです。たとえばcloudflare.comというドメインに対しては、`104.17.210.9`というIPアドレスを返すというように決まっています。

### A レコード

「A」は「アドレス」の略で、最も基本的なDNSレコードの種類です。特定のドメインとIPアドレスを結びつけます。IPv4の場合はAレコード、IPv6の場合はAAAAレコードが使用されます。例えば cloudflare.comの場合は`104.17.210.9`というIPアドレスが返されます。

今回はGitHub Pagesの4つのIPアドレスをAレコードとして登録しています。

### CNAMEレコード

CNAMEレコードは「別名」を定義するレコードです。あるドメインを、別のドメインにまるごとリダイレクトします。例えば `alias.example.com` → `target.example.net` のように異なるドメイン同士を結びつけることができます。

このような例の場合、内部では2段階の名前解決が行われます。 まず`alias.example.com`の名前解決で`target.example.net`を取得、2段階目で`target.example.net`から具体的なIPアドレスを取得します。

今回はwwwというサブドメインを「(GitHubユーザ名).github.io」に結びつけています。

設定内容
---

今回は以下のような合計5つのレコードを追加しました。次でこの意味について詳しく見ていきます。

| **タイプ** | **名前** | **IPv4アドレス** | **プロキシステータス** |
| ---------- | -------- | ---------------- | ---------------------- |
| A          | @        | 185.199.111.153  | DNS のみ               |
| A          | @        | 185.199.108.153  | DNS のみ               |
| A          | @        | 185.199.109.153  | DNS のみ               |
| A          | @        | 185.199.110.153  | DNS のみ               |

| **タイプ** | **名前** | **ターゲット**             | **プロキシステータス** |
| ---------- | -------- | -------------------------- | ---------------------- |
| CNAME      | www      | <GitHubユーザ名>.github.io | DNS のみ               |

A レコード追加で感じた疑問
---

### Q1. なぜ 4 つのレコードを追加したのか

### A1. ラウンドロビンDNSと呼ばれる負荷分散技術が使われているから

ラウンドロビンDNSとは、DNSレベルの負荷分散技術のことです。ひとつのホスト名に対して複数のIPアドレスを登録し、DNSサーバーがそのIPアドレスを順番に返します。これにより、クライアントのアクセスをIP間で分散させることができます。

たとえば先ほどの設定内容では4つのIPアドレスが登録されていました。仮に①〜④とすると、DNSサーバは「①→②→③→④→①→...」のようにループで返すIPアドレスを変更していきます。これによりクライアントごとに違うIPアドレスにアクセスさせることができます。（正しくはIPアドレスのリストを返すらしいです。なのでDNSサーバはリストの順番を入れ替えるだけで、返すIPアドレスを一つに決定しているわけではありません。またクライアント側の選択方法も一つには定まっているわけではないらしいです。）

**ラウンドロビンDNSの特徴**

ラウンドロビンDNSを使用するメリットとして実装が極めてシンプルになるという点があります。複数のサーバを用意してAレコードをその分設定すれば負荷分散が可能になります。また新たにロードバランサを立てる必要がないので、DNS管理サービスの料金のみ（低コスト）で負荷分散を行うことができます。

一方でデメリットも存在します。レコードの切り替えを行なったときにDNSキャッシュの有効期限（TTL）まで待つ必要があります。Cloudflareではデフォルトで300秒なので、最低限300秒以上は待つ必要があります。



### Q2. プロキシステータスはなぜ「DNSのみ」に設定しないといけないのか

### A2. GitHub Pages のドメイン検証が失敗するため

**プロキシステータスとは？**

まずプロキシステータスについて説明していきます。詳しくは「[Cloudflare Docs - Proxy status](https://developers.cloudflare.com/dns/proxy-status/?utm_source=chatgpt.com)」に記載されています。プロキシステータスで「プロキシ」に設定すると次のようなことができるようになります。

- DDoS攻撃からの保護
- CDNキャッシュ
- アクセス解析・ロギング

要するに仲介役のサーバをCloudflareが入れてくれて、セキュリティ強化、キャッシュ、ロギングなどを行なってくれるオプションです。

**GitHub Pages 側のドメイン所有権確認が通らない**

先ほどのプロキシをオンにするとドメイン所有権確認が通らなくなります。GitHub PagesではAレコードがGitHub PagesのIPアドレスを直接指しているかをチェックします。プロキシが有効化されていると、DNSの名前解決の際にCloudflareのプロキシのIPアドレスが返ってきてしまうのでドメイン検証に失敗するというわけです。

おわりに
---

他にも疑問点はたくさんあったのですが、体系的に学んだほうがいいと思ったので「[DNSがよくわかる教科書](https://www.amazon.co.jp/DNS%E3%81%8C%E3%82%88%E3%81%8F%E3%82%8F%E3%81%8B%E3%82%8B%E6%95%99%E7%A7%91%E6%9B%B8-%E6%A0%AA%E5%BC%8F%E4%BC%9A%E7%A4%BE%E6%97%A5%E6%9C%AC%E3%83%AC%E3%82%B8%E3%82%B9%E3%83%88%E3%83%AA%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9-JPRS-%E6%B8%A1%E9%82%89%E7%B5%90%E8%A1%A3%E3%80%81%E4%BD%90%E8%97%A4%E6%96%B0%E5%A4%AA%E3%80%81%E8%97%A4%E5%8E%9F%E5%92%8C%E5%85%B8/dp/479739448X)」という書籍を読んだ後にもう一度振り返ってみたいと思います。

